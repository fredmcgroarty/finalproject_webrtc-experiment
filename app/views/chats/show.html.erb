
<!DOCTYPE html>
<html>
  <head>
    <script src="http://simplewebrtc.com/latest.js"></script> 
      <style>
          #remoteVideos video {
              position: absolute;
              height: 500px;
              left:0px;
              top:0px;
              z-index:-1;
          }
          #localVideo {
              height: 100px;
              border: 1px solid white;
          }

          #chat{
             height: 450px;
             width: 300px;
             border: 1px solid gray;
             position: absolute;
             left:700px;
             top: 0px;
          }


          #chat div {
            padding:  2px 11px;
            border: 1px solid gray;
          }

         p{
            position: absolute;
            left:700px;
            top: 445px;
           
          }

          input{
            position: absolute;
            left:700px;
            top: 480px;
            width: 300px;
          }


      </style>
  </head>
  <body>

    <video id="localVideo"></video>
    <div id="remoteVideos"></div>
    <div id="chat"></div>
    <p> Start chatting below!</p>
    <input type='text' id='message'>

    <script>   
      var webrtc = new SimpleWebRTC({
        // the id/element dom element that will hold "our" video
        localVideoEl: 'localVideo',
        // the id/element dom element that will hold remote videos
        remoteVideosEl: 'remoteVideos',
        // immediately ask for camera access
        autoRequestMedia: true
      });


      // we have to wait until it's ready
      webrtc.on('readyToCall', function () {
        // you can name it anything
        webrtc.joinRoom('<%= params[:id] %>');
      });
    </script>


    <script type="text/javascript">


    $(document).ready(function(){


      ws = new WebSocketRails(window.location.host + '/websocket');

      $('#message').bind('keypress', function(e){

        if(e.keyCode !== 13)
          return;

        var value = this.value; 

        $.post('/messages', {message: value})
      });

      var channel = ws.subscribe('chat');
      channel.bind('new', function(chat) {
        var el = $('#chat');
        el.append('<div>' + chat.message + '</div>');
      });



    });






    </script>

  </body>
</html>







